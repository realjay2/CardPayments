<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Payment Store with Receipts Lookup</title>
<style>
  body {
    background-color: #f6f9fc;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    color: #32325d;
    margin: 0;
    padding: 20px;
  }
  .container {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    border-radius: 6px;
    box-shadow:
      0 0 20px rgba(50, 50, 93, 0.1),
      0 2px 5px rgba(50, 50, 93, 0.1),
      0 1px 1.5px rgba(0, 0, 0, 0.07);
    padding: 40px 30px;
  }
  h2, h3 {
    text-align: center;
    font-weight: 600;
    margin-bottom: 24px;
  }
  label {
    display: block;
    font-size: 14px;
    color: #6b7c93;
    margin-bottom: 6px;
    margin-top: 15px;
  }
  input[type="text"],
  input[type="number"],
  textarea {
    width: 100%;
    padding: 12px 14px;
    font-size: 16px;
    border-radius: 4px;
    border: 1px solid #ccd0d5;
    background: #fafafa;
    color: #32325d;
    transition: border-color 0.2s ease;
    box-sizing: border-box;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    resize: none;
  }
  input[type="text"]:focus,
  input[type="number"]:focus,
  textarea:focus {
    outline: none;
    border-color: #5469d4;
    background: white;
    box-shadow: 0 0 0 1px #5469d4;
  }
  button {
    margin-top: 25px;
    background-color: #5469d4;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
    padding: 14px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  button:hover {
    background-color: #4253b2;
  }
  .note {
    text-align: center;
    margin-top: 15px;
    font-size: 12px;
    color: #8898aa;
  }
  .hidden {
    display: none;
  }
  /* Approved message styles */
  #approvedMessage {
    position: fixed;
    bottom: -100px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #28a745;
    color: white;
    padding: 16px 30px;
    border-radius: 30px;
    font-weight: 600;
    font-size: 18px;
    display: flex;
    align-items: center;
    box-shadow: 0 0 15px rgba(40, 167, 69, 0.7);
    opacity: 0;
    pointer-events: none;
    transition: bottom 0.5s ease, opacity 0.5s ease;
    z-index: 1000;
  }
  #approvedMessage.show {
    bottom: 30px;
    opacity: 1;
    pointer-events: auto;
  }
  #approvedMessage svg {
    margin-right: 12px;
    fill: white;
    width: 24px;
    height: 24px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1.6rem;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
    font-size: 14px;
    word-break: break-word;
  }
  th {
    background-color: #f4f6f9;
    font-weight: 600;
  }
  .nav-bar {
    text-align: center;
    margin-bottom: 20px;
  }
  .nav-bar button {
    margin: 0 10px;
    width: auto;
  }
</style>
</head>
<body>

<div class="nav-bar">
  <button id="navDashboard" class="active">Dashboard</button>
  <button id="navReceipts">Receipts</button>
</div>

<div id="dashboard" class="container">
  <h2>Payment Dashboard</h2>
  <label for="paymentPurpose">Set Payment Purpose</label>
  <input type="text" id="paymentPurpose" placeholder="E.g. Consulting Fee, Product X" required />
  <button id="generateLinkBtn">Generate Payment Link</button>
  <div id="generatedLink" class="link-box hidden" title="Click to copy"></div>
  <p class="note">Click the generated link to copy it for sharing with customers.</p>
  <hr />
  <h3>Saved Payment Links</h3>
  <ul id="savedLinks"></ul>
</div>

<div id="paymentFormPage" class="container hidden">
  <h2>Make a Payment</h2>
  <form id="paymentForm" novalidate>
    <label for="formPurpose">Payment Purpose</label>
    <input type="text" id="formPurpose" name="formPurpose" placeholder="Payment Purpose" readonly />

    <label for="amount">Payment Amount</label>
    <input
      type="number"
      id="amount"
      name="amount"
      min="0.01"
      step="0.01"
      placeholder="0.00"
      required
    />
    <label for="cardNumber">Card Number</label>
    <input
      type="text"
      id="cardNumber"
      name="cardNumber"
      maxlength="19"
      placeholder="1234 5678 9012 3456"
      required
      autocomplete="cc-number"
    />
    <label for="cvc">CVC</label>
    <input type="text" id="cvc" name="cvc" maxlength="4" placeholder="123" required autocomplete="cc-csc" />

    <label for="expDate">Expiration Date (MM/YY)</label>
    <input type="text" id="expDate" name="expDate" maxlength="5" placeholder="08/25" required autocomplete="cc-exp" />

    <label for="name">Name on Card</label>
    <input type="text" id="name" name="name" placeholder="Jane Doe" required autocomplete="cc-name" />

    <label for="address">Billing Address</label>
    <textarea id="address" name="address" placeholder="123 Main Street, Apt 4" required></textarea>

    <button type="submit">Pay</button>
  </form>
</div>

<div id="receiptsPage" class="container hidden">
  <h2>Receipts</h2>
  <div id="receiptsContainer"><p>Loading receipts...</p></div>
</div>

<!-- Approved message -->
<div id="approvedMessage" role="alert" aria-live="assertive">
  <svg viewBox="0 0 24 24">
    <path d="M9 16.2l-3.5-3.5 1.4-1.4L9 13.4l7.1-7.1 1.4 1.4z"/>
  </svg> Payment Approved
</div>

<script>
  // Elements
  const navDashboard = document.getElementById('navDashboard');
  const navReceipts = document.getElementById('navReceipts');
  const dashboard = document.getElementById('dashboard');
  const paymentFormPage = document.getElementById('paymentFormPage');
  const receiptsPage = document.getElementById('receiptsPage');
  const generateLinkBtn = document.getElementById('generateLinkBtn');
  const savedLinks = document.getElementById('savedLinks');
  const generatedLink = document.getElementById('generatedLink');
  const paymentPurposeInput = document.getElementById('paymentPurpose');
  const formPurposeInput = document.getElementById('formPurpose');
  const paymentForm = document.getElementById('paymentForm');
  const receiptsContainer = document.getElementById('receiptsContainer');
  const approvedMessage = document.getElementById('approvedMessage');

  // Storage keys
  const LINKS_STORAGE_KEY = 'payment_links';

  // Navigation
  function setActiveNav(active) {
    if (active === 'dashboard') {
      dashboard.classList.remove('hidden');
      paymentFormPage.classList.add('hidden');
      receiptsPage.classList.add('hidden');
      navDashboard.classList.add('active');
      navReceipts.classList.remove('active');
    } else if (active === 'receipts') {
      dashboard.classList.add('hidden');
      paymentFormPage.classList.add('hidden');
      receiptsPage.classList.remove('hidden');
      navDashboard.classList.remove('active');
      navReceipts.classList.add('active');
      loadReceipts();
    } else if (active === 'payment') {
      dashboard.classList.add('hidden');
      paymentFormPage.classList.remove('hidden');
      receiptsPage.classList.add('hidden');
      navDashboard.classList.remove('active');
      navReceipts.classList.remove('active');
    }
  }

  navDashboard.addEventListener('click', () => setActiveNav('dashboard'));
  navReceipts.addEventListener('click', () => setActiveNav('receipts'));

  // URL safe encode/decode utility (for purpose)
  function encodePurpose(str) {
    return encodeURIComponent(str.trim().toLowerCase().replace(/\s+/g, '-'));
  }
  function decodePurpose(str) {
    return decodeURIComponent(str).replace(/-/g, ' ');
  }

  // Manage saved links in localStorage
  function saveLink(purpose, url) {
    let links = JSON.parse(localStorage.getItem(LINKS_STORAGE_KEY)) || [];
    if (!links.some(l => l.purpose === purpose)) {
      links.push({ purpose, url });
      localStorage.setItem(LINKS_STORAGE_KEY, JSON.stringify(links));
      refreshLinksList();
    }
  }

  function refreshLinksList() {
    const links = JSON.parse(localStorage.getItem(LINKS_STORAGE_KEY)) || [];
    if (links.length === 0) {
      savedLinks.innerHTML = '<li>No saved payment links</li>';
    } else {
      savedLinks.innerHTML = links.map(l => `<li><a href="${l.url}" target="_blank">${l.purpose}</a></li>`).join('');
    }
  }

  generateLinkBtn.addEventListener('click', () => {
    const purpose = paymentPurposeInput.value.trim();
    if (!purpose) {
      alert('Enter a payment purpose');
      return;
    }
    const baseURL = window.location.origin + window.location.pathname;
    const purposeEncoded = encodePurpose(purpose);
    const url = `${baseURL}?purpose=${purposeEncoded}`;
    generatedLink.textContent = url;
    generatedLink.classList.remove('hidden');
    generatedLink.onclick = () => {
      navigator.clipboard.writeText(url);
      alert('Link copied to clipboard!');
    };
    saveLink(purpose, url);
  });

  // Parse URL params to auto-open payment form with purpose
  function urlParam(key) {
    const params = new URLSearchParams(window.location.search);
    return params.get(key);
  }

  // Save payments under key `payments_${purpose}`
  function savePayment(payment) {
    const key = 'payments_' + encodePurpose(payment.purpose);
    let payments = JSON.parse(localStorage.getItem(key)) || [];
    payments.push(payment);
    localStorage.setItem(key, JSON.stringify(payments));
  }

  // Load payments grouped by saved links (purposes)
  function loadReceipts() {
    receiptsContainer.innerHTML = '';
    const links = JSON.parse(localStorage.getItem(LINKS_STORAGE_KEY)) || [];
    if (links.length === 0) {
      receiptsContainer.innerHTML = '<p>No receipts to show</p>';
      return;
    }
    links.forEach(({ purpose }) => {
      const key = 'payments_' + encodePurpose(purpose);
      const payments = JSON.parse(localStorage.getItem(key)) || [];
      if (payments.length === 0) return; // skip if no payments

      let html = `<h3>${purpose}</h3>
        <table>
          <thead>
            <tr>
              <th>Amount</th>
              <th>Name</th>
              <th>Card (last4)</th>
              <th>Date/Time</th>
              <th>Address</th>
            </tr>
          </thead>
          <tbody>
            ${payments.map(p => `<tr>
              <td>$${p.amount}</td>
              <td>${p.name}</td>
              <td>**** **** **** ${p.cardNumber.slice(-4)}</td>
              <td>${new Date(p.timestamp).toLocaleString()}</td>
              <td>${p.address}</td>
            </tr>`).join('')}
          </tbody>
        </table>`;
      receiptsContainer.insertAdjacentHTML('beforeend', html);
    });
  }

  // Show approved message animation
  function showApprovedMessage() {
    approvedMessage.classList.add('show');
    setTimeout(() => {
      approvedMessage.classList.remove('show');
    }, 3000);
  }

  // Form submission
  paymentForm.addEventListener('submit', e => {
    e.preventDefault();
    const paymentData = {
      purpose: formPurposeInput.value.trim(),
      amount: parseFloat(paymentForm.amount.value).toFixed(2),
      cardNumber: paymentForm.cardNumber.value.trim(),
      cvc: paymentForm.cvc.value.trim(),
      expDate: paymentForm.expDate.value.trim(),
      name: paymentForm.name.value.trim(),
      address: paymentForm.address.value.trim(),
      timestamp: new Date().toISOString(),
    };

    // Validate required fields and amount
    if (!paymentData.purpose || !paymentData.amount || paymentData.amount <= 0 ||
        !paymentData.cardNumber || !paymentData.cvc || !paymentData.expDate ||
        !paymentData.name || !paymentData.address) {
      alert('Please fill all required fields correctly.');
      return;
    }

    // (Add card type validation if needed)

    savePayment(paymentData);
    paymentForm.reset();
    showApprovedMessage();
  });

  // On load, parse URL param and show payment form if purpose present
  window.addEventListener('DOMContentLoaded', () => {
    refreshLinksList();
    const purpose = urlParam('purpose');
    if (purpose) {
      setActiveViewToPayment(decodePurpose(purpose));
    } else {
      setActiveNav('dashboard');
    }
  });

  function setActiveViewToPayment(purpose) {
    navDashboard.classList.remove('active');
    navReceipts.classList.remove('active');
    dashboard.classList.add('hidden');
    receiptsPage.classList.add('hidden');
    paymentFormPage.classList.remove('hidden');
    formPurposeInput.value = purpose;
  }

  // Navigation from nav buttons
function setActiveNav(page) {
  if (page === 'dashboard') {
    navDashboard.classList.remove('hidden');
    navReceipts.classList.remove('hidden');
    navDashboard.classList.add('active');
    navReceipts.classList.remove('active');
    dashboard.classList.remove('hidden');
    paymentFormPage.classList.add('hidden');
    receiptsPage.classList.add('hidden');
  } else if (page === 'receipts') {
    navDashboard.classList.remove('hidden');
    navReceipts.classList.remove('hidden');
    navDashboard.classList.remove('active');
    navReceipts.classList.add('active');
    dashboard.classList.add('hidden');
    paymentFormPage.classList.add('hidden');
    receiptsPage.classList.remove('hidden');
    loadReceipts();
  } else if (page === 'payment') {
    navDashboard.classList.add('hidden');
    navReceipts.classList.add('hidden');
    dashboard.classList.add('hidden');
    paymentFormPage.classList.remove('hidden');
    receiptsPage.classList.add('hidden');
  }
}

// Example usage:
// When your URL has ?purpose=... call:
setActiveNav('payment');


  navDashboard.addEventListener('click', () => setActiveNav('dashboard'));
  navReceipts.addEventListener('click', () => setActiveNav('receipts'));
</script>

</body>
</html>
